/*!
    *
    * Wijmo Library 5.20213.824
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var l={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(l[t]=e[t]);l.default=e;return l};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("@grapecity/wijmo"),wijmo_grid_1=require("@grapecity/wijmo.grid"),mXlsx=__importStar(require("@grapecity/wijmo.xlsx")),selfModule=__importStar(require("@grapecity/wijmo.grid.xlsx"));function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}exports.softDetail=softDetail;function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}exports.softMultiRow=softMultiRow;function softTransposed(){return wijmo_1._getModule("wijmo.grid.transposed")}exports.softTransposed=softTransposed;function softTransposedMultiRow(){return wijmo_1._getModule("wijmo.grid.transposedmultirow")}exports.softTransposedMultiRow=softTransposedMultiRow;class FlexGridXlsxConverter{static save(e,l,t){let o=new mXlsx.Workbook;this._saveFlexGridToWorkbook(o,e,l,!1,null);t&&o.save(t);return o}static saveAsync(e,l,t,o,r,s,i){let n=new mXlsx.Workbook;if(!i){this._saveFlexGridToWorkbook(n,e,l,!1,null);t?n.saveAsync(t,e=>{wijmo_1.isFunction(o)&&o(e,n)},r,null):wijmo_1.isFunction(o)&&o(null,n);return n}let a=null!=t;this.cancelAsync(()=>{let i,d=[e.collectionView&&e.collectionView.collectionChanged,e.columns&&e.columns.collectionChanged,e.rows&&e.rows.collectionChanged,e.resizedColumn,e.resizedRow],removeHandlers=()=>d.forEach(e=>{e&&e.removeHandler(restart)}),restart=()=>{this._cs&&this._cs.cancel(!1);clearTimeout(i);i=setTimeout(()=>{removeHandlers();n=null;this.saveAsync(e,l,t,o,r,s)},100)},finish=()=>{clearTimeout(i);this._cs=null;removeHandlers()};this._cs=new mXlsx._SyncPromise(null,finish);d.forEach(e=>{e&&e.addHandler(restart)});this._saveFlexGridToWorkbook(n,e,l,!0,this._cs,e=>{wijmo_1.isFunction(s)&&s(a?Math.round(mXlsx._map(e,0,100,0,50)):e)}).then(()=>{if(t){n._externalCancellation=()=>this._cs;n.saveAsync(t,e=>{finish();wijmo_1.isFunction(o)&&o(e,n)},e=>{finish();wijmo_1.isFunction(r)&&r(e)},e=>{wijmo_1.isFunction(s)&&s(Math.round(mXlsx._map(e,0,100,51,100)))})}else{finish();wijmo_1.isFunction(s)&&s(100);wijmo_1.isFunction(o)&&o(null,n)}},e=>{finish();throw e})});return null}static cancelAsync(e){if(this._cs){this._cs.cancel();setTimeout(()=>{this._cs=null;wijmo_1.isFunction(e)&&e()},100)}else wijmo_1.isFunction(e)&&e()}static load(e,l,t){if(l instanceof Blob)_blobToBuffer(l,o=>{l=null;let r=new mXlsx.Workbook;r.load(o);o=null;e.deferUpdate(()=>{this._loadToFlexGrid(e,r,t);r=null})});else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,t);l=null});else{if(!(l instanceof ArrayBuffer||wijmo_1.isString(l)))throw"Invalid workbook.";let o=new mXlsx.Workbook;o.load(l);l=null;e.deferUpdate(()=>{this._loadToFlexGrid(e,o,t);o=null})}}static loadAsync(e,l,t,o,r){if(l instanceof Blob)_blobToBuffer(l,s=>{l=null;let i=new mXlsx.Workbook;i.loadAsync(s,()=>{s=null;e.deferUpdate(()=>{this._loadToFlexGrid(e,i,t);o&&o(i);i=null})},r)});else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,t);o&&o(l);l=null});else{if(!(l instanceof ArrayBuffer||wijmo_1.isString(l)))throw"Invalid workbook.";let s=new mXlsx.Workbook;s.loadAsync(l,()=>{l=null;e.deferUpdate(()=>{this._loadToFlexGrid(e,s,t);o&&o(s);s=null})},r)}}static _saveFlexGridToWorkbook(e,l,t,o,r,s){let i=new mXlsx._SyncPromise(r),n=new mXlsx.WorkSheet,a=!t||null==t.includeColumnHeaders||t.includeColumnHeaders,d=!(!t||null==t.includeRowHeaders)&&t.includeRowHeaders,u=_IncludeCellStyles.Cache,c=t?t.includeColumns:null,m=t?t.formatItem:null,f=[];t&&(u=!1===wijmo_1.asBoolean(t.includeCellStyles,!0)?_IncludeCellStyles.None:!1===wijmo_1.asBoolean(t.quickCellStyles,!0)?_IncludeCellStyles.Regular:_IncludeCellStyles.Cache);let h=u===_IncludeCellStyles.Cache?new _StyleCache(500):null;null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style);let _,w=l.wj_sheetInfo;n.name=t?t.sheetName:"";n.visible=!t||!1!==t.sheetVisible;if(w&&w.tables&&w.tables.length>0)for(let e=0;e<w.tables.length;e++)n.tables.push(w.tables[e]);if(!w&&(u!==_IncludeCellStyles.None||m)){(_=document.createElement("div")).style.visibility="hidden";_.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true");l.hostElement.appendChild(_)}let p=d?l.rowHeaders.columns.length:0,g=this._getPerRowColumnsSettings(l,d?[l.topLeftCells,l.columnHeaders]:[l.columnHeaders]),x=g.cols,y=softMultiRow()&&l instanceof softMultiRow().MultiRow?this._getPerRowColumnsSettings(l,d?[l.rowHeaders,l.cells]:[l.cells],l.rowsPerItem).cols:null,b=x.length,C=[[l.topLeftCells,l.columnHeaders],[l.rowHeaders,l.cells],[l.bottomLeftCells,l.columnFooters]];a||C.shift();let S=C.map(e=>e[1].rows.length).reduce((e,l)=>e+l);x.length&&x[0].forEach((e,l)=>{let t=g.bndCols[0][l];if(l>=p&&c&&!c(t))return;let o=new mXlsx.WorkbookColumn;o._deserialize(e);n._addWorkbookColumn(o)});this._saveContentToWorksheet(r,o,Date.now(),0,{panels:C,panelIdx:0,globRowIdx:0,rowsOffset:0,totalRows:S},l,n,d,e=>e==wijmo_grid_1.CellType.Cell&&y?y:x,u,_,f,h,c,m,e=>{s(Math.round(e/S*100))},()=>{let o=new mXlsx.WorkbookFrozenPane;o.rows=a?l.frozenRows+b:l.frozenRows;o.columns=d?l.frozenColumns+p:l.frozenColumns;n.frozenPane=o;e._addWorkSheet(n);if(!w&&(u!==_IncludeCellStyles.None||m)){l.hostElement.removeChild(_);f.forEach(e=>e.forEach(e=>{e&&e.parentElement&&e.parentElement.removeChild(e)}))}h&&h.clear();e.activeWorksheet=t?t.activeWorksheet:null;i.resolve()});return i}static _saveContentToWorksheet(e,l,t,o,r,s,i,n,a,d,u,c,m,f,h,_,w){let p=d?20:200;for(let g=o;g<r.totalRows;g++){if(e&&e.cancelled)return;if(l&&g-o>p&&Date.now()-t>100){setTimeout(()=>{if(!e||!e.cancelled){_(g);this._saveContentToWorksheet(e,l,Date.now(),g,r,s,i,n,a,d,u,c,m,f,h,_,w)}},0);return}for(;g-r.rowsOffset>=r.panels[r.panelIdx][1].rows.length;){r.rowsOffset+=r.panels[r.panelIdx][1].rows.length;r.panelIdx++}let x=r.panels[r.panelIdx],y=x[0],b=x[1],C=g-r.rowsOffset,S=b.rows[C];if(b.cellType!==wijmo_grid_1.CellType.Cell&&S.renderSize<=0||S instanceof wijmo_grid_1._NewRowTemplate)continue;let T=0,j={},k=new mXlsx.WorkbookRow,R=S instanceof wijmo_grid_1.GroupRow,v=0;b.cellType===wijmo_grid_1.CellType.Cell&&(R?v=S.level:s.rows.maxGroupLevel>-1&&(v=s.rows.maxGroupLevel+1));let X=a(b.cellType);n&&(T=this._parseFlexGridRowToSheetRow(y,j,C,0,X,d,u,c,m,R,v,f,h));this._parseFlexGridRowToSheetRow(b,j,C,T,X,d,u,c,m,R,v,f,h);if(j.cells.length>0){k._deserialize(j);i._addWorkbookRow(k,r.globRowIdx)}r.globRowIdx++}wijmo_1.isFunction(w)&&w()}static _loadToFlexGrid(e,l,t){if(softTransposedMultiRow()&&e instanceof softTransposedMultiRow().TransposedMultiRow)throw"Not supported.";t=t||{};let o,r=null!=e.wj_sheetInfo,s={},i=[],n=[],a={};e.itemsSource=null;e.columns.clear();e.columnHeaders.rows.clear();e.rows.clear();e.frozenColumns=0;e.frozenRows=0;let d=null==t.sheetIndex||isNaN(t.sheetIndex)?0:t.sheetIndex;if(d<0||d>=l.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=t.sheetName)for(let e=0;e<l.sheets.length;e++)if(t.sheetName===l.sheets[e].name){o=l.sheets[e];break}if(null==(o=o||l.sheets[d]).rows)return;let u=this._getColumnCount(o.rows),c=this._getRowCount(o.rows,u),m=o.columns;for(let l=0;l<u;l++){e.columns.push(new wijmo_grid_1.Column);if(m[l]){isNaN(+m[l].width)||(e.columns[l].width=+m[l].width);m[l].visible||null==m[l].visible||(e.columns[l].visible=!!m[l].visible);m[l].style&&m[l].style.wordWrap&&(e.columns[l].wordWrap=m[l].style.wordWrap)}}let f,h=(null==t.includeColumnHeaders||t.includeColumnHeaders)&&o.rows.length>0,_=h?this._getColumnHeadersHeight(o):0,w=!1,p=[],g=o.frozenPane&&o.frozenPane.rows,x=o.frozenPane&&o.frozenPane.columns;g=wijmo_1.isNumber(g)&&!isNaN(g)?g:null;x=wijmo_1.isNumber(x)&&!isNaN(x)?x:null;for(let l=_;l<c;l++){let t=!1,d=null,c=o.rows[l];if(c){let e=l+1;for(;e<o.rows.length;){let l=o.rows[e];if(l){(isNaN(c.groupLevel)&&!isNaN(l.groupLevel)||!isNaN(c.groupLevel)&&c.groupLevel<l.groupLevel)&&(t=!0);break}e++}}if(t&&!o.summaryBelow){f&&(f.isCollapsed=w);(f=new wijmo_grid_1.GroupRow).isReadOnly=!1;w=null!=c.collapsed&&c.collapsed;f.level=isNaN(c.groupLevel)?0:c.groupLevel;a[f.level]=w;this._checkParentCollapsed(a,f.level)&&f._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0);e.rows.push(f)}else{let l=new wijmo_grid_1.Row;c&&this._checkParentCollapsed(a,c.groupLevel)&&l._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0);e.rows.push(l)}c&&c.height&&!isNaN(c.height)&&(e.rows[l-_].height=c.height);for(let o=0;o<u;o++)if(c){let a=c.cells[o],m=a?a.formula:null;m&&"="!==m[0]&&(m="="+m);if(a&&a.textRuns&&a.textRuns.length>0){e.rows[l-_].isContentHtml=!0;e.setCellData(l-_,o,this._parseTextRunsToHTML(a.textRuns))}else e.setCellData(l-_,o,m&&r?m:this._getItemValue(a));t||this._setColumn(p,o,a);let f=l*u+o,h=a?a.style:null;if(h){d=null==d?!!h.wordWrap:d&&!!h.wordWrap;if(r){let e,t=mXlsx.Workbook._parseExcelFormat(a);if(h.hAlign)e=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(h.hAlign,mXlsx.HAlign));else switch(this._getItemType(a)){case wijmo_1.DataType.Number:e="right";break;case wijmo_1.DataType.Boolean:e="center";break;default:e=t&&0===t.search(/[n,c,p]/i)?"right":"left"}s[f]={fontWeight:h.font&&h.font.bold?"bold":"none",fontStyle:h.font&&h.font.italic?"italic":"none",textDecoration:h.font&&h.font.underline?"underline":"none",textAlign:e,fontFamily:h.font&&h.font.family?h.font.family:"",fontSize:h.font&&h.font.size?h.font.size+"px":"",color:h.font&&h.font.color?h.font.color:"",backgroundColor:h.fill&&h.fill.color?h.fill.color:"",whiteSpace:h.wordWrap?"pre-wrap":"normal",format:t};if(h.borders){if(h.borders.left){this._parseBorderStyle(h.borders.left.style,"Left",s[f]);s[f].borderLeftColor=h.borders.left.color}if(h.borders.right){this._parseBorderStyle(h.borders.right.style,"Right",s[f]);s[f].borderRightColor=h.borders.right.color}if(h.borders.top){this._parseBorderStyle(h.borders.top.style,"Top",s[f]);s[f].borderTopColor=h.borders.top.color}if(h.borders.bottom){this._parseBorderStyle(h.borders.bottom.style,"Bottom",s[f]);s[f].borderBottomColor=h.borders.bottom.color}}if(h.fill&&h.fill.color){let e=s[f],t=h.borders,r=h.fill.color;if(t){t.left&&t.left.color||(e.borderLeftColor=r);t.right&&t.right.color||o===x-1||(e.borderRightColor=r);t.top&&t.top.color||(e.borderTopColor=r);t.bottom&&t.bottom.color||l===g-1||(e.borderBottomColor=r)}else{e.borderLeftColor=r;o!==x-1&&(e.borderRightColor=r);e.borderTopColor=r;l!==g-1&&(e.borderBottomColor=r)}}h.font&&-1===n.indexOf(h.font.family)&&n.push(h.font.family)}}r&&a&&wijmo_1.isNumber(a.rowSpan)&&a.rowSpan>0&&wijmo_1.isNumber(a.colSpan)&&a.colSpan>0&&(a.rowSpan>1||a.colSpan>1)&&i.push(new wijmo_grid_1.CellRange(l,o,l+a.rowSpan-1,o+a.colSpan-1))}if(c){this._checkParentCollapsed(a,c.groupLevel)||c.visible||null==c.visible||(e.rows[l-_].visible=c.visible);e.rows[l-_].wordWrap=!!c.style&&!!c.style.wordWrap||!!d}}f&&(f.isCollapsed=w);null!=x&&(e.frozenColumns=x);null!=g&&(e.frozenRows=h&&g>0?g-1:g);for(let l=0;l<e.columnHeaders.columns.length;l++){let t=p[l],o=e.columns[l];o.isRequired=!1;if(t){t.dataType===wijmo_1.DataType.Boolean&&(o.dataType=t.dataType);o.format=t.format;o.align=t.hAlign;o.wordWrap=o.wordWrap||!!t.wordWrap}}for(let l=0;l<Math.max(_,1);l++)e.columnHeaders.rows.push(new wijmo_grid_1.Row);for(let l=0;l<_;l++)for(let t=0;t<e.columnHeaders.columns.length;t++){let r=o.rows[l]?o.rows[l].cells[t]:null,s=r&&null!=r.value?r.value:"",i=e.columnHeaders.columns[t];if(s){let e=mXlsx.Workbook._parseExcelFormat(r);s=wijmo_1.Globalize.format(s,e)}i.header=i.header||s;e.columnHeaders.setCellData(l,t,s)}if(r){let l=null==t.sheetVisible||t.sheetVisible;e.wj_sheetInfo.name=o.name;e.wj_sheetInfo.visible=!0===l||!1!==o.visible;e.wj_sheetInfo.styledCells=s;e.wj_sheetInfo.mergedRanges=i;e.wj_sheetInfo.fonts=n;e.wj_sheetInfo.tables=o.tables}}static _getColumnHeadersHeight(e){let l;if(!e||!(l=e.rows).length)return 0;if(!l[0])return 1;let t=0;for(let e=1;t<l.length&&e>0;t++,e--){let o=l[t].cells.reduce((e,l)=>Math.max(e,l.rowSpan||0),1);o>e&&(e=o)}return t}static _escapePlainText(e){return null==e?"":""===e?"'":e&&("'"===e[0]||e.length>1&&"="===e[0]&&"="===e[1])?"'"+e:e}static _parseFlexGridRowToSheetRow(e,l,t,o,r,s,i,n,a,d,u,c,m){let f=e.grid,h=f.wj_sheetInfo,_=e.rows[t],w=0,p=h&&h.evaluateFormula;null==_.recordIndex?e.cellType===wijmo_grid_1.CellType.ColumnHeader&&e.rows.length>1&&(w=Math.min(t,r.length-1)):w=_.recordIndex;l.cells||(l.cells=[]);l.visible=_.isVisible;l.height=_.renderHeight||e.rows.defaultSize;l.groupLevel=u;d&&(l.collapsed=_.isCollapsed);_.wordWrap&&(l.style={wordWrap:_.wordWrap});let g,x=_.constructor===wijmo_grid_1.Row||_.constructor===wijmo_grid_1._NewRowTemplate||softTransposed()&&f instanceof softTransposed().TransposedGrid&&_ instanceof wijmo_grid_1.Row||softDetail()&&_.constructor===softDetail().DetailRow||softMultiRow()&&_.constructor===softMultiRow()._MultiRow||softTransposedMultiRow()&&_ instanceof softTransposedMultiRow()._MultiRow,y=softDetail()&&_.constructor===softDetail().DetailRow,b=0;const C=Math.round(mXlsx._xlsx._parsePixelToCharWidth(f.treeIndent)||0),getTreeIndent=e=>e*C;for(;b<e.columns.length;b++){let C,S,T,j=1,k=1,R=!1,v=f._getBindingColumn(e,t,e.columns[b]),X=0;if(h&&e===f.cells){let l=t*e.columns.length+b;h.mergedRanges&&(C=this._getMergedRange(t,b,h.mergedRanges));h.styledCells&&(S=h.styledCells[l])}else if(s!==_IncludeCellStyles.None){T=this._getMeasureCell(e,b,i,n);S=(C=f.getMergedRange(e,t,b,!1))?this._getCellStyle(e,T,C.bottomRow,C.rightCol,a,!!m)||{}:this._getCellStyle(e,T,t,b,a,!!m)||{}}C||(C=f.getMergedRange(e,t,b,!1));if(C){if(t===C.topRow&&b===C.leftCol){k=C.bottomRow-C.topRow+1;j=this._getColSpan(e,C,c);R=!0}}else R=!0;if(c&&!c(v))continue;let F,W,I,B,A,M,D,N=r[w]?r[w][b+o]:null;if(x||d){I=R?e.getCellData(t,b,!0):null;B=R?e.getCellData(t,b,!1):null;W=this._isFormula(I);F=null;A=wijmo_1.isDate(B);if(S&&S.format){M=S.format;/[hsmyt\:]/i.test(M)&&(A=!0);D=mXlsx.Workbook._parseCellFormat(S.format,A)}else if(N&&N.style&&N.style.format){M=v.format;D=N.style.format}else D=null;W&&null!=p&&wijmo_1.isFunction(p)&&(F=p(I));if(!D)if(A)D="m/d/yyyy";else if(wijmo_1.isNumber(B)&&!v.dataMap)D=wijmo_1.isInt(B)?"#,##0":"#,##0.00";else if(W){let e=I.toLowerCase();if(e.indexOf("now()")>-1){D="m/d/yyyy h:mm";A=!0}else if(e.indexOf("today()")>-1||e.indexOf("date(")>-1){D="m/d/yyyy";A=!0}else if(e.indexOf("time(")>-1){D="h:mm AM/PM";A=!0}}else D="General"}else{I=R?f.columnHeaders.getCellData(0,b,!0):null;D="General"}let E=void 0;if(wijmo_1.isString(I)&&-1!==I.indexOf("<span")){E=this._parseToTextRuns(I);I=null}let H=this._parseCellStyle(S)||{};if(e===f.cells&&d&&_.hasChildren&&b===f.columns.firstVisibleIndex){let e;if(W&&null!=F)e=F;else{I?e=I:R&&(e=_.getGroupHeader());e&&(e=e.replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'"))}if(null==e&&!S)continue;!(A=wijmo_1.isDate(e))&&M&&"d"===M.toLowerCase()&&wijmo_1.isInt(e)&&(D="0");e=wijmo_1.isString(e)?mXlsx.Workbook._unescapeXML(e):e;b===f.columns.firstVisibleIndex&&f.treeIndent&&(X=getTreeIndent(u));g={value:e,isDate:A,formula:W?this._parseToExcelFormula(I,A):null,colSpan:j,rowSpan:k,style:this._extend(H,{format:D,font:f.childItemsPath?{}:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:X}),textRuns:E}}else{I=wijmo_1.isString(I)?mXlsx.Workbook._unescapeXML(I):I;B=wijmo_1.isString(B)?mXlsx.Workbook._unescapeXML(B):B;!A&&M&&"d"===M.toLowerCase()&&wijmo_1.isInt(B)&&(D="0");let l;l=H&&H.hAlign?H.hAlign:N&&N.style&&null!=N.style.hAlign?wijmo_1.asEnum(N.style.hAlign,mXlsx.HAlign,!0):wijmo_1.isDate(B)?mXlsx.HAlign.Left:mXlsx.HAlign.General;b!==f.columns.firstVisibleIndex||!f.treeIndent||l!==mXlsx.HAlign.Left&&l!==mXlsx.HAlign.General||(X=getTreeIndent(u));g={value:W?F:"General"!==D||""===I&&null==B?this._escapePlainText(B):this._escapePlainText(I),isDate:A,formula:W?this._parseToExcelFormula(I,A):null,colSpan:b<f.columns.firstVisibleIndex?1:j,rowSpan:k,style:this._extend(H,{format:D,hAlign:l,vAlign:k>1?e===f.cells||!1===f.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:X}),textRuns:E}}if(m){m(new XlsxFormatItemEventArgs(e,new wijmo_grid_1.CellRange(t,b),T,i,n,a,g))}if(y){let l=e.getCellElement(t,b);if(l){let e=_.detail;l.appendChild(e);wijmo_1.Control.refreshAll(e)}}l.cells.push(g)}return o+b}static _parseCellStyle(e,l=!1){if(null==e)return null;let t=e.fontSize;t=t?+t.substring(0,t.indexOf("px")):null;isNaN(t)&&(t=null);let o=e.whiteSpace;o=!!o&&o.indexOf("pre")>-1;let r=e.textAlign;"start"===r&&(r="rtl"===e.direction?"right":"left");"end"===r&&(r="rtl"===e.direction?"left":"right");return{font:{bold:"bold"===e.fontWeight||+e.fontWeight>=700,italic:"italic"===e.fontStyle,underline:"underline"===(e.textDecorationStyle||e.textDecoration),family:this._parseToExcelFontFamily(e.fontFamily),size:t,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,l),hAlign:mXlsx.Workbook._parseStringToHAlign(r),wordWrap:o}}static _parseBorder(e,l){let t={left:this._parseEgdeBorder(e,"Left"),right:this._parseEgdeBorder(e,"Right"),top:this._parseEgdeBorder(e,"Top"),bottom:this._parseEgdeBorder(e,"Bottom")};if(l){t.vertical=this._parseEgdeBorder(e,"Vertical");t.horizontal=this._parseEgdeBorder(e,"Horizontal")}return t}static _parseEgdeBorder(e,l){let t,o=e["border"+l+"Style"],r=e["border"+l+"Width"];r&&(r=parseFloat(r));if(o&&"none"!==o&&"hidden"!==o&&0!==r){t={};switch(o=o.toLowerCase()){case"dotted":t.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":t.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":t.style=mXlsx.BorderStyle.Double;break;default:t.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}t.color=e["border"+l+"Color"]}return t}static _parseBorderStyle(e,l,t){let o="border"+l+"Style",r="border"+l+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:t[o]="dotted";t[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:t[o]="dashed";t[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:t[o]="dashed";t[r]="2px";break;case mXlsx.BorderStyle.Double:t[o]="double";t[r]="3px";break;case mXlsx.BorderStyle.Medium:t[o]="solid";t[r]="2px";break;case mXlsx.BorderStyle.Thick:t[o]="solid";t[r]="3px";break;default:t[o]="solid";t[r]="1px"}}static _parseToExcelFontFamily(e){let l;e&&(l=e.split(","))&&l.length>0&&(e=l[0].replace(/\"|\'/g,""));return e}static _parseToExcelFormula(e,l){let t=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi);if(t)for(let l=0;l<t.length;l++){let o=t[l],r=o.substring(0,o.lastIndexOf(")"))+", 1)";e=e.replace(o,r)}t=null;if(t=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi)){let o=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;for(let r=0;r<t.length;r++){let s=t[r],i=s.match(o);if(i&&2===i.length){let t=i[1];if(!/^d{1,4}?$/.test(t)){let o=mXlsx.Workbook._parseCellFormat(t,l),r=s.replace(t,o);e=e.replace(s,r)}}}}return e}static _parseToTextRuns(e){let l=e.split("<span "),t=[];for(let e=0;e<l.length;e++){let o,r=l[e];if(-1!==r.indexOf("</span>")){o={text:r.substring(r.indexOf(">")+1,r.indexOf("</span>")),font:this._parseToTextRunFont(r.substring(r.indexOf('style="')+7,r.indexOf(';"')))}}else o={text:r};t.push(o)}return t}static _parseToTextRunFont(e){let l,t=e.split(";");if(t.length>0){let e,o,r,s,i,n;for(let l=0;l<t.length;l++){let a=t[l].split(":");if(2===a.length){a[1]=a[1].trim();switch(a[0]){case"font-size":s=+a[1].substring(0,a[1].indexOf("px"));isNaN(s)&&(s=null);break;case"font-weight":e="bold"===a[1]||+a[1]>=700;break;case"font-style":o="italic"===a[1];break;case"text-decoration-style":case"text-decoration":r="underline"===a[1];break;case"font-family":i=this._parseToExcelFontFamily(a[1]);break;case"color":n=a[1]}}}l={bold:e,italic:o,underline:r,family:i,size:s,color:n}}return l}static _getMeasureCell(e,l,t,o){let r=o[e.cellType],s=r&&r[l],i=null==s;if(s){if(this.hasCssText){s.style.cssText="";s.style.visibility="hidden"}}else{r||(o[e.cellType]=r=[]);r[l]=s=t.cloneNode()}!i&&s.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(s):e.hostElement.appendChild(s));return s}static _getColumnSetting(e,l,t){let o=e;null!=e.colspan&&(o=this._getRenderColumn(l,t));return o?{autoWidth:!0,width:o.renderWidth||t.defaultSize,visible:o.visible&&0!==o.width&&!o._getFlag(wijmo_grid_1.RowColFlags.ParentCollapsed),style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===wijmo_1.DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(o.getAlignment())),wordWrap:o.wordWrap}}:null}static _getPerRowColumnsSettings(e,l,t){let o=[],r=[];l.forEach((s,i)=>{let n=0,a=i>0?l[0].columns.length:0;for(let l=0;l<s.rows.length&&!(null!=t&&l>=t);l++)if(!(s.rows[l].renderSize<=0)){o[n]=o[n]||[];r[n]=r[n]||[];s.columns.forEach((t,i)=>{let d=e._getBindingColumn(s,l,t),u=this._getColumnSetting(d,i,s.columns);if(u){o[n][a+i]=u;r[n][a+i]=d}});n++}});return{cols:o,bndCols:r}}static _toExcelHAlign(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e}static _getColumnCount(e){let l=0;for(let t=0;t<e.length;t++){let o=e[t]&&e[t].cells?e[t].cells:[];if(o&&o.length>0){let e=o.length;wijmo_1.isInt(o[e-1].colSpan)&&o[e-1].colSpan>1&&(e=e+o[e-1].colSpan-1);e>l&&(l=e)}}return l}static _getRowCount(e,l){var t=e.length,o=t-1;for(let r=0;r<l;r++)e:for(;o>=0;o--){let l=e[o],s=(l&&l.cells?l.cells:[])[r];if(s&&(null!=s.value&&""!==s.value||wijmo_1.isInt(s.rowSpan)&&s.rowSpan>1)){wijmo_1.isInt(s.rowSpan)&&s.rowSpan>1&&o+s.rowSpan>t&&(t=o+s.rowSpan);break e}}return t}static _numAlpha(e){let l=Math.floor(e/26)-1;return(l>-1?this._numAlpha(l):"")+String.fromCharCode(65+e%26)}static _getItemType(e){return null==e||null==e.value||isNaN(e.value)?null:wijmo_1.getType(e.value)}static _setColumn(e,l,t){let o=e[l];if(o){let e,l=this._getItemType(t);o.dataType!==l&&o.dataType===wijmo_1.DataType.Boolean&&l!==wijmo_1.DataType.Boolean&&(o.dataType=l);if(t&&null!=t.value&&(!wijmo_1.isString(t.value)||!wijmo_1.isNullOrWhiteSpace(t.value))){let e=mXlsx.Workbook._parseExcelFormat(t);e&&o.format!==e&&"General"!==e&&(o.format=e)}if(t&&t.style){t.style.hAlign&&(e=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(t.style.hAlign,mXlsx.HAlign)));null==o.wordWrap?o.wordWrap=!!t.style.wordWrap:o.wordWrap=o.wordWrap&&!!t.style.wordWrap}e||l!==wijmo_1.DataType.Number||(e="right");o.hAlign=e}else e[l]={dataType:this._getItemType(t),format:mXlsx.Workbook._parseExcelFormat(t),hAlign:"",wordWrap:null}}static _getItemValue(e){if(null==e||null==e.value)return null;let l=e.value;wijmo_1.isString(l)&&"'"===l[0]&&(l=l.substr(1));return wijmo_1.isNumber(l)&&isNaN(l)?"":l instanceof Date&&isNaN(l.getTime())?"":l}static _getCellStyle(e,l,t,o,r,s){let i,n=e.grid;try{let i=!(r&&!n.formatItem.hasHandlers&&!n.itemFormatter&&!s);n.cellFactory.updateCell(e,t,o,l,null,i);l.className=l.className.replace("wj-state-selected","");l.className=l.className.replace("wj-state-multi-selected","")}catch(e){return null}if(r){let t=e.hostElement,o=l,s=o.style.cssText.split(/;\s+/).filter(e=>{let l=e.substring(0,e.indexOf(":"));return/^(color|background|border|font|text|whitespace)/i.test(l)}).join(";");do{s=o.className+s}while(o!==t&&(o=o.parentElement));if(!(i=r.getValue(s))){i=window.getComputedStyle(l);r.add(s,i)}}else i=window.getComputedStyle(l);return i}static _parseTextRunsToHTML(e){let l="";for(let t=0;t<e.length;t++){let o=e[t],r=o.font;l+=r?'<span style="'+(r.bold?"font-weight: bold;":"")+(r.italic?"font-style: italic;":"")+(r.underline?"text-decoration: underline;":"")+(r.family?"font-family: "+r.family+";":"")+(null!=r.size?"font-size: "+r.size+"px;":"")+(r.color?"color: "+r.color+";":"")+'">'+o.text+"</span>":o.text}return l}static _extend(e,l){for(let t in l){let o=l[t];wijmo_1.isObject(o)&&e[t]?wijmo_1.copy(e[t],o):e[t]=o}return e}static _checkParentCollapsed(e,l){let t=!1;Object.keys(e).forEach(o=>{!0===e[o]&&!1===t&&!isNaN(l)&&+o<l&&(t=!0)});return t}static _getColSpan(e,l,t){let o=0;for(let r=l.leftCol;r<=l.rightCol;r++)t&&!t(e.columns[r])||o++;return o}static _getRenderColumn(e,l){return e>=l.length?null:l[e]}static _getMergedRange(e,l,t){for(let o=0;o<t.length;o++){let r=t[o];if(e>=r.topRow&&e<=r.bottomRow&&l>=r.leftCol&&l<=r.rightCol)return r}return null}static _isFormula(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]}}exports.FlexGridXlsxConverter=FlexGridXlsxConverter;class XlsxFormatItemEventArgs extends wijmo_grid_1.CellRangeEventArgs{constructor(e,l,t,o,r,s,i){super(e,l);this._cell=t;this._patternCell=o;this._xlsxCell=i;this._cellsCache=r;this._styleCache=s}get cell(){return this._cell}get xlsxCell(){return this._xlsxCell}set xlsxCell(e){this._xlsxCell=e}getFormattedCell(){if(!this._cell){this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache);FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col,this._styleCache,!0)}return this._cell}}exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs;var _IncludeCellStyles;!function(e){e[e.None=0]="None";e[e.Regular=1]="Regular";e[e.Cache=2]="Cache"}(_IncludeCellStyles||(_IncludeCellStyles={}));class _StyleCache{constructor(e){this._cache={};this._size=0;this._max=e}add(e,l){this._size>=this._max&&this.clear();this._cache[e]=this._cloneStyle(l);this._size++}clear(){this._cache={};this._size=0}getValue(e){return this._cache[e]||null}hasKey(e){return!!this._cache[e]}_cloneStyle(e){if(!e)return null;let l={},toCamel=e=>e.replace(/\-([a-z])/g,(e,l,t)=>t>0?l.toUpperCase():l);for(let t=0,o=e.length;t<o;t++){let o=e[t];l[toCamel(o)]=e.getPropertyValue(o)}return l}}exports._StyleCache=_StyleCache;function _blobToBuffer(e,l){if(e&&l)if(e.arrayBuffer)e.arrayBuffer().then(e=>l(e));else{let t=new FileReader;t.onload=()=>{l(t.result);t=null};t.readAsArrayBuffer(e)}}exports._blobToBuffer=_blobToBuffer;wijmo_1._registerModule("wijmo.grid.xlsx",selfModule);